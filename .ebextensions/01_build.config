commands:
  01_system_packages:
    command: yum install -y gcc python3-devel postgresql-devel
  02_node_corepack:
    command: |
      if ! command -v node >/dev/null 2>&1; then
        curl -fsSL https://rpm.nodesource.com/setup_20.x | bash -
        yum install -y nodejs
      fi
      npm install -g pnpm@9

container_commands:
  01_pnpm_install:
    command: |
      pnpm --dir client install --frozen-lockfile

  02_build_client:
    command: |
      pnpm --dir client build

  03_sync_client_into_server:
    command: |
      mkdir -p server/src/metakb/build
      rsync -a --delete client/dist/ server/src/metakb/build/
